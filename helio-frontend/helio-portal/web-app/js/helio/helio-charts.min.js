var helioChart;var chartObject;var chartContainer,additionalContainer,chartTitle;var helioConfObject;var actualPlotType='default';function createHELIOChart(containerName,additionalContainerName,chartTitleName,jsonObject,catalogueName){chartContainer=containerName;additionalContainer=additionalContainerName;chartTitle=chartTitleName;chartObject=new helioChartObject();chartObject.setJSON(jsonObject);helioConfObject=getHELIOconfiguration(catalogueName);var standardPlotType=helioConfObject.standardPlot;chartObject.parseJSON(window['helioConfObject'][standardPlotType]['yAxisDefault'],window['helioConfObject'][standardPlotType]['xAxisDefault'],window['helioConfObject'][standardPlotType]['addInfo']);var stringDropDown='<div id="selector"><form><p>';for(var m=0;m<window['helioConfObject'][standardPlotType]['yAxis']['length'];m++){var actualYAxisArray=window['helioConfObject'][standardPlotType]['yAxis'];var actual_sTitle=actualYAxisArray[m];var actual_sDescription='';for(var descr_var=0;descr_var<chartObject.jsonObject.aoColumns.length;descr_var++){if(chartObject.jsonObject.aoColumns[descr_var].sTitle==actual_sTitle){actual_sDescription=chartObject.jsonObject.aoColumns[descr_var].sDescription;}}
if(getIndexInAoColumns(chartObject.jsonObject.aoColumns,actual_sTitle)!=-1){stringDropDown+='<input type="checkbox" name="seriesName" value="'+actual_sTitle+'"><label title="'+actual_sDescription+'">'+actual_sTitle+'</label><br />';}}
var plotType_xAxisMenu='';if(actualPlotType=='default'){plotType_xAxisMenu=helioConfObject.standardPlot;}else{plotType_xAxisMenu=actualPlotType;}
var xAxis_values=window['helioConfObject'][plotType_xAxisMenu]['xAxis'];if(xAxis_values.length>1){stringDropDown+='<br />Value for x-axis:<br />';for(var p=0;p<xAxis_values.length;p++){var actual_xAxisValue=xAxis_values[p];var actual_sDescription_xAxis='';for(var descr_var_xAxis=0;descr_var_xAxis<chartObject.jsonObject.aoColumns.length;descr_var_xAxis++){if(chartObject.jsonObject.aoColumns[descr_var_xAxis].sTitle==actual_xAxisValue){actual_sDescription_xAxis=chartObject.jsonObject.aoColumns[descr_var_xAxis].sDescription;}}
stringDropDown+='<input type="radio" name="xAxisValue" value="'+actual_xAxisValue+'"><label title="'+actual_sDescription_xAxis+'">'+actual_xAxisValue+'</label><br />';}}
if(helioConfObject.plots.length>1){stringDropDown+='<br />Type of plot:<br />';for(var o=0;o<helioConfObject.plots.length;o++){var actual_plotType=helioConfObject.plots[o];stringDropDown+='<input type="radio" name="plotType" value="'+actual_plotType+'">'+actual_plotType+'<br />';}}
stringDropDown+='</p><p><input type="button" value="Display selected series" onclick="seriesSelectedRedraw(this.form)" /></p></form></div><br /><div id="range"></div>';document.getElementById(additionalContainerName).innerHTML=stringDropDown;createLineChart(chartContainer,additionalContainer,chartTitle,chartObject.dataStream,chartObject.yAxisArray);}
function seriesSelectedRedraw(form){var drawScatter=false;var drawColumn=false;var actualPlotType='';if(helioConfObject.standardPlot=='scatter'){drawScatter=true;actualPlotType='scatter';}else if(helioConfObject.standardPlot=='column'){drawColumn=true;actualPlotType='column'}
var selectedNames=[];var xAxisValueName='';for(var i=0;i<form.elements.length;i++){var element=form.elements[i];if((element.type=='checkbox')&&(element.checked)&&(element.name=='seriesName')){selectedNames.push(form.elements[i].value);}else if((element.type=='radio')&&(element.checked)&&(element.name=='plotType')){if(element.value=='scatter'){drawScatter=true;drawColumn=false;actualPlotType='scatter';}else if(element.value=='column'){drawScatter=false;drawColumn=true;actualPlotType='column';}}else if((element.type=='radio')&&(element.checked)&&(element.name=='xAxisValue')){xAxisValueName=element.value;}}
if(xAxisValueName==''){xAxisValueName=window['helioConfObject'][actualPlotType]['xAxisDefault'];}
if(selectedNames.length==0){selectedNames.push('Events');}
chartObject.parseJSON(selectedNames,xAxisValueName,window['helioConfObject'][actualPlotType]['addInfo']);if(drawScatter){createLineChart(chartContainer,additionalContainer,chartTitle,chartObject.dataStream,chartObject.yAxisArray);}else if(drawColumn){createColumnChart(chartContainer,additionalContainer,chartTitle,chartObject.dataStream,chartObject.yAxisArray);}else{alert('Error: No Plot type selected');}}
function helioChartObject(){this.jsonObject={};this.dataStream={};this.dataName="default series name";this.chartTitle="default chart title";this.yAxisArray=[];this.setJSON=setJSON;this.parseJSON=parseJSON;}
function setJSON(jsonVar){this.jsonObject=jsonVar;}
var helioColors=['#4572A7','#AA4643','#89A54E','#80699B','#3D96AE','#DB843D','#92A8CD','#A47D7C','#B5CA92'];function parseJSON(arrayOfSeriesNames,xAxisValue,arrayAddInfo){var aaDataObject=this.jsonObject.aaData;var lengthOfSeries=aaDataObject.length;var numberOfSeries=arrayOfSeriesNames.length;var seriesObjectArray=[];this.yAxisArray.length=0;for(var i=0;i<numberOfSeries;i++){var seriesObject={};seriesObject.name=arrayOfSeriesNames[i];seriesObject.yAxis=i;var yAxisObject={};var yAxisObjectLabel={};var yAxisObjectLabelStyle={};yAxisObjectLabelStyle.color=helioColors[i%9];yAxisObjectLabel.style=yAxisObjectLabelStyle;yAxisObject.labels=yAxisObjectLabel;var yAxisObjectTitle={};var yAxisObjectTitleStyle={};yAxisObjectTitle.text=arrayOfSeriesNames[i];yAxisObjectTitleStyle.color=helioColors[i%9];yAxisObjectTitle.style=yAxisObjectTitleStyle;yAxisObject.title=yAxisObjectTitle;this.yAxisArray.push(yAxisObject);var dataObjectArray=[];for(var j=0;j<lengthOfSeries;j++){var dataObject={};var xValueIndex=getIndexInAoColumns(this.jsonObject.aoColumns,xAxisValue);var xValueDate=parseDateFormat(aaDataObject[j][xValueIndex+1]);dataObject.x=xValueDate;if(arrayOfSeriesNames[i]=='Events'){dataObject.y=i+1;}else{var yValueIndex=getIndexInAoColumns(this.jsonObject.aoColumns,arrayOfSeriesNames[i]);dataObject.y=aaDataObject[j][yValueIndex+1];}
dataObject.xName=xAxisValue;dataObject.yName=arrayOfSeriesNames[i];var additionalDataString='';for(var l=0;l<arrayAddInfo.length;l++){var addValueIndex=getIndexInAoColumns(this.jsonObject.aoColumns,arrayAddInfo[l]);additionalDataString+=arrayAddInfo[l];additionalDataString+=': ';if(addValueIndex==-1){additionalDataString+='-';additionalDataString+='; ';}else{additionalDataString+=aaDataObject[j][addValueIndex+1];additionalDataString+='; ';}
if(l%3==2){additionalDataString+='<br />';}}
additionalDataString=additionalDataString.slice(0,-2);dataObject.additionalInformation=additionalDataString;dataObjectArray.push(dataObject);}
seriesObject.data=dataObjectArray;seriesObjectArray.push(seriesObject);}
this.dataStream=seriesObjectArray;}
function getIndexInAoColumns(aoColumnsObject,searchedValue){for(var aoVar=0;aoVar<aoColumnsObject.length;aoVar++){for(var prop in aoColumnsObject[aoVar]){if(aoColumnsObject[aoVar][prop]==searchedValue){return aoVar;}}}
return-1;}
function parseDateFormat(stringToParse){if(stringToParse==undefined){return"-";}else{var splittedString=stringToParse.split('T');var dateString=splittedString[0];var timeString=splittedString[1];var splittedDateString=dateString.split('-');var splittedTimeString=timeString.split(':');var dateToReturn=new Date(splittedDateString[0],splittedDateString[1]-1,splittedDateString[2],splittedTimeString[0],splittedTimeString[1],splittedTimeString[2]);return dateToReturn;}}
function compareSeriesNames(stringToCompare,arrayOfSeriesNames){for(var i=0;i<arrayOfSeriesNames.length;i++){if(stringToCompare==arrayOfSeriesNames[i]){return true;}}
return false;}
function createLineChart(containerName,additionalContainerName,chartTitle,dataSeriesObject,yAxesObject){var options={chart:{ignoreHiddenSeries:true,renderTo:containerName,spacingTop:20,spacingRight:20,spacingBottom:30,spacingLeft:20,type:'scatter',zoomType:'xy',events:{selection:function(event){var min,max,ex2;if(event.xAxis){min=Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',event.xAxis[0].min);max=Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',event.xAxis[0].max);}else{min='-';max='-';}
var rangeString='<b>Range:</b><br />Minimum: ';rangeString+=min;rangeString+='<br />Maximum: ';rangeString+=max;document.getElementById('range').innerHTML=rangeString;}}},credits:{enabled:false},title:{text:chartTitle},plotOptions:{series:{turboThreshold:50000,cursor:'pointer',events:{click:function(event){alert(event.point.xName+': '+event.point.x+';   '+event.point.yName+': '+event.point.y);}}}},tooltip:{crosshairs:[true,true],formatter:function(){return'<b>'+this.point.xName+':</b> '+this.x+'; <b>'+this.point.yName+':</b> '+this.y+';<br /><b>Additional information:</b> '+this.point.additionalInformation;},shadow:false,snap:2},xAxis:{type:'datetime',minRange:1000},yAxis:[],series:[],exporting:{enabled:true}}
for(var i=0;i<dataSeriesObject.length;i++){options.series.push(dataSeriesObject[i]);}
for(var j=0;j<dataSeriesObject.length;j++){options.yAxis.push(yAxesObject[j]);}
helioChart=new Highcharts.Chart(options);}
function createColumnChart(containerName,additionalContainerName,chartTitle,dataSeriesObject,yAxesObject){var options={chart:{ignoreHiddenSeries:true,renderTo:containerName,spacingTop:20,spacingRight:20,spacingBottom:30,spacingLeft:20,type:'column',zoomType:'x',events:{selection:function(event){var min,max,ex2;if(event.xAxis){min=Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',event.xAxis[0].min);max=Highcharts.dateFormat('%Y-%m-%d %H:%M:%S',event.xAxis[0].max);}else{min='-';max='-';}
var rangeString='<b>Range:</b><br />Minimum: ';rangeString+=min;rangeString+='<br />Maximum: ';rangeString+=max;document.getElementById('range').innerHTML=rangeString;}}},credits:{enabled:false},title:{text:chartTitle},plotOptions:{series:{turboThreshold:50000,cursor:'pointer',events:{click:function(event){alert(event.point.xName+': '+event.point.x+'<br />'+event.point.yName+': '+event.point.y);}}}},tooltip:{crosshairs:[true,true],formatter:function(){return'<b>'+this.point.xName+':</b> '+this.x+'; <b>'+this.point.yName+':</b> '+this.y+';<br /><b>Additional information:</b> '+this.point.additionalInformation;},shadow:false,snap:2},xAxis:{type:'datetime',minRange:1000},yAxis:[],series:[],exporting:{enabled:true}}
for(var i=0;i<dataSeriesObject.length;i++){options.series.push(dataSeriesObject[i]);}
for(var j=0;j<dataSeriesObject.length;j++){options.yAxis.push(yAxesObject[j]);}
helioChart=new Highcharts.Chart(options);}